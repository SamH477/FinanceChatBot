<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Website</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1> Finance Chatbot</h1>
        </div>
        <div class="chat-messages">
            <div class="message from-bot">
                <p>Hello! Ask me what stocks to invest in?</p>
            </div>
            <!-- More chat messages go here -->
        </div>
        <div class="chat-input">
            <form method="POST" action="/recommend">
                <input type="text" id="ticker" name="ticker" placeholder="Type your message...">
            </form>
            <button id="startRecognition"> &#127908</button>
            <button id="send-button">Send</button>
        </div>
    </div>
    <script>
const startRecognitionButton = document.getElementById('startRecognition');
const response = document.getElementById('response');
const chatMessages = document.querySelector('.chat-messages');
let recognizing = false;
let recognition = new webkitSpeechRecognition();

recognition.continuous = true;
recognition.interimResults = true;

recognition.onerror = function(event) {
    if (event.error === 'no-speech') {
        recognition.start();
    }
};

recognition.onstart = function() {
    recognizing = true;
    startRecognitionButton.textContent = "Listening...";
};

recognition.onend = function() {
    recognizing = false;
    startRecognitionButton.textContent = 'ðŸŽ¤';
    response.textContent = "";
    startRecognitionButton.style.display = "inline";
};

recognition.onresult = function(event) {
    let result = "";
    for (let i = event.resultIndex; i < event.results.length; i++) {
        if (event.results[i].isFinal) {
            result += event.results[i][0].transcript;
        }
    }
    appendResponse(result, '');  // Only send the audio data, not the HTML content
};

startRecognitionButton.addEventListener('click', () => {
    if (recognizing) {
        recognition.stop();
    } else {
        recognition.start();
    }
});

function appendResponse(command, responseText) {
    const responseItem = document.createElement('div');
    responseItem.classList.add('message', 'from-user');
    responseItem.innerHTML = `<p><strong>You:</strong> ${command}</p>`;
    chatMessages.appendChild(responseItem);

    // You can also append the response from the chatbot if needed
    if (responseText !== '') {
        const botResponseItem = document.createElement('div');
        botResponseItem.classList.add('message', 'from-bot');
        botResponseItem.innerHTML = `<p><strong>Chatbot:</strong> ${responseText}</p>`;
        chatMessages.appendChild(botResponseItem);
    }
}

function sendToServer(data) {
    fetch('/', {
        method: 'POST',
        body: data,  // Send the recognized text directly
        headers: {
            'Content-Type': 'text/plain'
        }
    })
    .then(response => response.json())
    .then(data => {
        appendResponse(data.command, data.response);
    });
}
</script>
</body>
</html>